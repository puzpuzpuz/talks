---
marp: true
theme: default
---

<style>
section.lead h1 {
  padding-top: 12px;
}

section.lead h1, section.lead h2 {
  padding-left: 30px;
}

section {
  font-size: 30px;
}

h1 {
  font-size: 42px;
  color: #5c5c5c;
}

pre {
  line-height: 1.4;
}

img[alt~="center"] {
  display: block;
  margin: 0 auto;
}

table td {
  width: 150px;
}
</style>

<!-- _class: lead -->

# –ù–µ–º–Ω–æ–≥–æ –æ–± –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞.<br/>–ö–∞–∑–∞–ª–æ—Å—å –±—ã, –ø—Ä–∏ —á–µ–º —Ç—É—Ç Node.js?

## –ê–Ω–¥—Ä–µ–π –ü–µ—á–∫—É—Ä–æ–≤

![bg](./images/hazelcast-bg.jpg)

---

<!-- paginate: true -->

# –û –¥–æ–∫–ª–∞–¥—á–∏–∫–µ

* –ü–∏—à—É –Ω–∞ Java (–æ—á–µ–Ω—å –¥–æ–ª–≥–æ), Node.js (–¥–æ–ª–≥–æ)
* Node.js core collaborator
* –ò–Ω—Ç–µ—Ä–µ—Å—ã: –≤–µ–±, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
* –ú–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ —Ç—É—Ç:

  - https://twitter.com/AndreyPechkurov
  - https://github.com/puzpuzpuz
  - https://medium.com/@apechkurov

---

![h:80](./images/imdg-logo.jpg)

* Hazelcast In-Memory Data Grid (IMDG)
* –ë–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
* –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä - `Map`, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞–∫ –∫—ç—à
* –ù–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ Java, —É–º–µ–µ—Ç embedded –∏ standalone —Ä–µ–∂–∏–º—ã
* –•–æ—Ä–æ—à–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
* –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ high-load –∏ low-latency –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö
* –û–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è: IoT, in-memory stream processing, payment processing, fraud detection –∏ —Ç.–¥.

---

<br/><br/>

# Hazelcast IMDG Node.js client

<style scoped>
section {
  background: #fff url(images/hazelcast-plus-node.jpg) no-repeat center 80px;
  background-size: 400px;
}
</style>

* https://github.com/hazelcast/hazelcast-nodejs-client
* P.S. –ê –≤–æ—Ç –¥–æ–∫–ª–∞–¥ –ø—Ä–æ –∏—Å—Ç–æ—Ä–∏—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π: https://youtu.be/CSnmpbZsVD4

---

# –°—Ç–∞—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö lock'–æ–≤

```js
const lock = await client.getLock('my-lock');

await lock.lock();
try {
    // "–∑–∞—â–∏—â–µ–Ω–Ω—ã–π" –∫–æ–¥
    // (–¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É)
} finally {
    await lock.unlock();
}
```

---

# –ö–∞–∫ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

![h:600 center](./images/ap-lock-1.png)

---

# –ö–∞–∫ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

![h:600 center](./images/ap-lock-2.png)

---

# –•—å—é—Å—Ç–æ–Ω, —É –Ω–∞—Å –ø—Ä–æ–±–ª–µ–º–∞

* –í 2017 Kyle Kingsbury (a.k.a. aphyr) –ø–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª Hazelcast
* https://jepsen.io/analyses/hazelcast-3-8-3

<br/>

![h:250 center](./images/kkingsbury.png)

---

# –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —É—Å–ª–æ–≤–∏—è—Ö network partition

![h:600 center](./images/ap-lock-partition-1.png)

---

# –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —É—Å–ª–æ–≤–∏—è—Ö network partition

![h:600 center](./images/ap-lock-partition-2.png)

---

# –ù–∞—à –æ—Ç–≤–µ—Ç

* –° –≤–µ—Ä—Å–∏–∏ 3.12 —É –Ω–∞—Å –µ—Å—Ç—å CP Subsystem (—Ç.–µ. production-ready Raft<br/>—Å Jepsen —Ç–µ—Å—Ç–∞–º–∏ –∏ lock'–∞–º–∏ üôÇ)
* https://docs.hazelcast.org/docs/4.0.3/manual/html-single/index.html#cp-subsystem

---

# –ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö lock'–æ–≤

```js
// –£ –Ω–µ–π –≤–Ω—É—Ç—Ä–∏ Raft
const lock = await client.getCPSubsystem().getLock('my-lock');

const fence = await lock.lock();
try {
    // "–∑–∞—â–∏—â–µ–Ω–Ω—ã–π" –∫–æ–¥
    // (–¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É)
} finally {
    await lock.unlock(fence);
}
```

P.S. –ê –µ—â–µ —É –Ω–∞—Å –µ—Å—Ç—å Semaphore, AtomicLong –∏ AtomicReference.

---

# –ß—Ç–æ –∑–∞ –∑–≤–µ—Ä—å Raft?

* –ê–ª–≥–æ—Ä–∏—Ç–º –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞, –ø—Ä–∏–¥—É–º–∞–Ω–Ω—ã–π D.Ongaro –∏ J.Ousterhout<br/>(Stanford) –≤ 2013
* –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —é–∑–∫–µ–π—Å—ã:
  - –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ
  - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ lock'–∏* (–∏ –Ω–µ —Ç–æ–ª—å–∫–æ)
  - –í—ã–±–æ—Ä –ª–∏–¥–µ—Ä–∞
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å)
  - –ê—Ç–æ–º–∞—Ä–Ω—ã–π –∫–æ–º–º–∏—Ç (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

---

# –ü–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

* –ù–∞—á–∏–Ω–∞–µ–º –ø—É–≥–∞—Ç—å—Å—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
* –ó–Ω–∞–∫–æ–º–∏–º—Å—è —Å –º–æ–¥–µ–ª—è–º–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ (consistency)
* CAP —Ç–µ–æ—Ä–µ–º–∞ –∏ –ø—Ä–æ—á–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
* –ß—Ç–æ –∑–∞ –∑–≤–µ—Ä—å - –∞–ª–≥–æ—Ä–∏—Ç–º –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞?
* –ò—Å—Ç–æ—Ä–∏—è: Paxos –∏ –µ–≥–æ –ø–æ–¥–≤–∏–¥—ã, Raft
* CASPaxos, –∫–∞–∫ –æ–¥–∏–Ω –∏–∑ –Ω–µ–¥–∞–≤–Ω–∏—Ö Paxos-–æ–±—Ä–∞–∑–Ω—ã—Ö
* Pet project: CASPaxos –Ω–∞ Node.js

---

<style scoped>
section h1 {
  position: absolute;
  top: 261px;
  left: 90px;
}
</style>

![bg](./images/hazelcast-bg-no-logo.jpg)

# –ù–∞—á–∏–Ω–∞–µ–º –ø—É–≥–∞—Ç—å—Å—è<br/>—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

---

# –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –¥–æ —É–∂–∞—Å–∞ –∏—Å—Ç–æ—Ä–∏—è

![h:600 center](./images/general-timeline.png)

---

# –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

* –ù–∞–∑–æ–≤–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—É, —Ö—Ä–∞–Ω—è—â—É—é —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ–±—â–µ–µ) –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∞—à–∏–Ω–∞—Ö, —Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ç—å—é
* –î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ –±—É–¥–µ–º –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ

---

# –û—Ç–ª–∏—á–∏—è: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

![h:450 center](./images/comparison-1.png)

---

# –û—Ç–ª–∏—á–∏—è: —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏

![h:450 center](./images/comparison-2.png)

---

# –û—Ç–ª–∏—á–∏—è: –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç–∫–∞–∑–∞

![h:450 center](./images/comparison-3.png)

---

# –û—Ç–ª–∏—á–∏—è: –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –æ—Ç–∫–∞–∑–∞

![h:450 center](./images/comparison-4.png)

---

# Fallacies of distributed computing

* –ò–Ω–∂–µ–Ω–µ—Ä—ã –∏–∑ Sun (R.I.P.) –µ—â–µ –≤ 94–º —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–ª–∏ —Ç–∞–∫–æ–π —Å–ø–∏—Å–æ–∫:
  - **The network is reliable**
  - **Latency is zero**
  - **Bandwidth is infinite**
  - The network is secure
  - Topology doesn't change
  - There is one administrator
  - Transport cost is zero
  - The network is homogeneous
* P.S. –î–æ–±–∞–≤–∏–º —Å—é–¥–∞ "**Clocks are in sync**"

---

# –°–µ—Ç—å üåê

* –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏
* –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç:
  - –ë—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ç—É–¥–∞/–æ–±—Ä–∞—Ç–Ω–æ
  - –ù–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏ –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–µ—Å–ª–∏ —Å–µ—Ç—å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π)
  - –ë—ã—Ç—å –ø–æ–ª—É—á–µ–Ω, –Ω–æ –º–∞—à–∏–Ω–∞-–∞–¥—Ä–µ—Å–∞—Ç –¥–∞–ª–∞ —Å–±–æ–π –¥–æ –∏–ª–∏ –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
* –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è - –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç

---

# –õ–æ–∫–∞–ª—å–Ω—ã–µ üïê

* –ö–∞–∂–¥–∞—è –º–∞—à–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º (`Date.now()`)
* –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–µ —á–∞—Å—ã (`process.hrtime`) –ø–æ–º–æ–≥–∞—é—Ç, –Ω–æ –¥–∞–ª–µ–∫–æ –Ω–µ –≤—Å–µ–≥–¥–∞
* –í –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞–º —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –∏–º–µ—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —á–∞—Å—ã

---

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ üïê

* –£–≤—ã, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ) —á–∞—Å—ã –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã –±–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∂–µ–ª–µ–∑–∞
* –ë–∞–π–∫–∞: –≤ Google Spanner —á–∞—Å—ã –≤ –¶–û–î —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 7 –º—Å (–∞—Ç–æ–º–Ω—ã–µ —á–∞—Å—ã + GPS)
* –û—Ñ—Ñ—Ç–æ–ø–∏–∫: –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ "—á–∞—Å—ã" —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—É

---

# –ß–µ–≥–æ –º—ã –∂–¥–µ–º –æ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã? ü§î

---

# –ú–æ–π –ª–∏—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

1. –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
2. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
3. –£–¥–æ–±—Å—Ç–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

# –ß–µ–≥–æ –º—ã –µ—â–µ –∂–¥–µ–º?

* –î–æ–ø—É—Å—Ç–∏–º, —á—Ç–æ –º—ã –∂–¥–µ–º —Ç–æ–≥–æ –∂–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è, —á—Ç–æ –∏ —É —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
* –ê –∏–º–µ–Ω–Ω–æ - —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å, –∫–∞–∫ –µ—Å–ª–∏ –±—ã —ç—Ç–æ –±—ã–ª–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (–ø–æ–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏–º—Å—è –Ω–∞ —ç—Ç–æ–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–µ)

---

# –§–∏–≥–Ω—è –≤–æ–ø—Ä–æ—Å - —Å–µ–π—á–∞—Å –ø—Ä–∏–¥—É–º–∞–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º

1. –õ—é–±–æ–π —É–∑–µ–ª –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã (–ø—Ä–æ—á–∏—Ç–∞—Ç—å/–∑–∞–ø–∏—Å–∞—Ç—å)
2. –ó–∞—Ç–µ–º - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–∞ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É–∑–ª—ã
3. –ñ–¥–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ (–∫–æ–Ω—Å–µ–Ω—Å—É—Å –∂–µ–∂ üòÅ)
4. –î–æ–∂–¥–∞–≤—à–∏—Å—å –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç—É —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-0.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-1.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-2.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-3.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-4.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-5.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-6.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-7.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-8.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-9.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-10.png)

---

# –ß—Ç–æ –Ω–µ —Ç–∞–∫ —Å –Ω–∞—à–∏–º –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–µ–º?

![h:600 center](./images/primitive-consensus-11.png)

---

<style scoped>
section h1 {
  position: absolute;
  top: 261px;
  left: 90px;
}
</style>

![bg](./images/hazelcast-bg-no-logo.jpg)

# –ó–Ω–∞–∫–æ–º–∏–º—Å—è —Å –º–æ–¥–µ–ª—è–º–∏<br/>—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ (consistency)

---

# –ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

–ú–æ–¥–µ–ª—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ (consistency model) - —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–∏—Å—Ç–µ–º–∞ (–≤–Ω–µ–∑–∞–ø–Ω–æ, –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–±–æ—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

![h:620 center](./images/consistency-models.png)

Source: https://jepsen.io/consistency

---

# Linearizable consistency model

* –û–¥–Ω–∞ –∏–∑ –Ω–∞–∏–±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏—Ö (—Å–∏–ª—å–Ω—ã—Ö) –º–æ–¥–µ–ª–µ–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è __–æ–¥–Ω–æ–≥–æ__ –æ–±—ä–µ–∫—Ç–∞
* –ò–º–µ–Ω–Ω–æ –µ–µ –º—ã –∏ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–ª–∏ (–Ω–∞–¥–µ—é—Å—å) —Ä–∞–Ω–µ–µ:
  "—Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å, –∫–∞–∫ –µ—Å–ª–∏ –±—ã —ç—Ç–æ –±—ã–ª–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞"

<!--
# Eventual consistency

–°–∏—Å—Ç–µ–º–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö —á–µ—Ä–µ–∑ –∫–∞–∫–æ–µ-—Ç–æ (–Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ) –≤—Ä–µ–º—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏

# Monotonic reads

–°–∏—Å—Ç–µ–º–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π) –∫–ª–∏–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç –∑–∞–ø–∏—Å—å, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —á—Ç–µ–Ω–∏—è —Ç–æ–π –∂–µ –∑–∞–ø–∏—Å–∏ –≤–µ—Ä–Ω—É—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ, –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ–∑–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
-->

---

# –ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ linearizability

* –°–∏—Å—Ç–µ–º–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ, –≤ __–Ω–µ–∫–æ—Ç–æ—Ä–æ–º__ (–æ–±—â–µ–º –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤) –ø–æ—Ä—è–¥–∫–µ, –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—â–∏–º –ø–æ—Ä—è–¥–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
* –¢.–µ. –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è A –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –¥–æ –Ω–∞—á–∞–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ B, —Ç–æ B –¥–æ–ª–∂–Ω–∞ —É—á–∏—Ç—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ A

---

# –î–æ–ø—É—Å—Ç–∏–º—ã–π –ø–æ—Ä—è–¥–æ–∫

![h:600 center](./images/linearizability-1.png)

---

# –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–æ—Ä—è–¥–æ–∫

![h:600 center](./images/linearizability-2.png)

---

<style scoped>
section h1 {
  position: absolute;
  top: 261px;
  left: 90px;
}
</style>

![bg](./images/hazelcast-bg-no-logo.jpg)

# CAP —Ç–µ–æ—Ä–µ–º–∞ –∏ –ø—Ä–æ—á–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

# CAP —Ç–µ–æ—Ä–µ–º–∞

* –°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∞ Eric Brewer –≤ 1998, –∫–∞–∫ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
* –í 2002 –ø–æ—è–≤–∏–ª–æ—Å—å —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ
* –†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ —Å –æ–¥–Ω–∏–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º
* CAP:
  - Consistency: –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è –ª–∏–Ω–µ–∞—Ä–∏–∑—É–µ–º–æ—Å—Ç—å
  - Availability: –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —É–∑–ª–æ–º —Å–∏—Å—Ç–µ–º—ã, –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –æ–∂–∏–¥–∞–µ–º–æ–º—É –æ—Ç–≤–µ—Ç—É (–Ω–µ –∫ –æ—à–∏–±–∫–µ)
  - Partition tolerance: –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Å–µ—Ç—å

---

# Partition tolerance

Network partition - —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–æ–≥–¥–∞ —É–∑–ª—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ –Ω–∏—Ö –Ω–µ –º–æ–≥—É—Ç –æ–±—â–∞—Ç—å—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π

<!-- –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É –≤ —Ç–µ–º—É -->

---

# –ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

–í —É—Å–ª–æ–≤–∏—è—Ö network partition —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å:
* –î–æ—Å—Ç—É–ø–Ω–∞ (AP)
* –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∞ (CP)

P.S. CA –æ–ø—Ü–∏–∏ –≤ CAP —Ç–µ–æ—Ä–µ–º–µ –Ω–µ—Ç –∏ –≤ –ø–æ–º–∏–Ω–µ

---

# –ö—Ä–∏—Ç–∏–∫–∞

* –û–¥–Ω–æ–±–æ–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—á–µ–º—É-—Ç–æ –ø—Ä–∏–∂–∏–ª–∞—Å—å
* –ù–∞–ø—Ä–∏–º–µ—Ä, –†–°–£–ë–î —Å –æ–¥–Ω–æ–π read-only —Ä–µ–ø–ª–∏–∫–æ–π –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –Ω–∏ CP, –Ω–∏ AP
* –¢–µ–æ—Ä–µ–º–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç –æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã, —Ç.–µ. AP —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å —Å–∫–æ–ª—å —É–≥–æ–¥–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ
* –ù–∞–∫–æ–Ω–µ—Ü, network partition - –¥–∞–ª–µ–∫–æ –Ω–µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –æ—Ç–∫–∞–∑–∞

---

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

* PACELC —Ç–µ–æ—Ä–µ–º–∞ - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ CAP —Ç–µ–æ—Ä–µ–º—ã (Daniel J. Abadi, 2010)
* PAC = PA | PC (—Ç–∞ –∂–µ CAP —Ç–µ–æ—Ä–µ–º–∞)
* ELC = EL | EC:
  - E: else
  - L: latency
  - C: consistency

---

<style scoped>
section h1 {
  position: absolute;
  top: 261px;
  left: 90px;
}
</style>

![bg](./images/hazelcast-bg-no-logo.jpg)

# –ß—Ç–æ –∑–∞ –∑–≤–µ—Ä—å - –∞–ª–≥–æ—Ä–∏—Ç–º –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞?

---

# –ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

* –ê–ª–≥–æ—Ä–∏—Ç–º –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ - –∞–ª–≥–æ—Ä–∏—Ç–º, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π —É–∑–ª–∞–º —Å–∏—Å—Ç–µ–º—ã –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—å –∫–æ–Ω—Å–µ–Ω—Å—É—Å, —Ç.–µ. –ø—Ä–∏–Ω—è—Ç—å —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ __–æ —Ç–æ–º –∏–ª–∏ –∏–Ω–æ–º__ –¥–µ–π—Å—Ç–≤–∏–∏
* –ü–æ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º –ø–æ–Ω–∏–º–∞—é—Ç __–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–µ__ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Paxos)
* –° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –æ—Ç–∫–∞–∑–æ–≤ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ non-Byzantine faults
* P.S. –ê –µ—â–µ –µ—Å—Ç—å "—Å–∫–∞–Ω–¥–∞–ª—å–Ω—ã–π" FLP result (1985)

---

# –°–≤—è–∑—å —Å linearizability

* –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –∫–æ–Ω—Å–µ–Ω—Å—É—Å –Ω—É–∂–µ–Ω –Ω–∞ __–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏__ –¥–µ–π—Å—Ç–≤–∏–π
* –ü–æ—ç—Ç–æ–º—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ atomic broadcast (total order broadcast) - –∫–æ–Ω—Å–µ–Ω—Å—É—Å —Ç—É—Ç –Ω—É–∂–µ–Ω –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è –æ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–π—Å—Ç–≤–∏–∏
* –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ linearizability –∏ total order broadcast –º–æ–∂–Ω–æ —Å–≤–µ—Å—Ç–∏ –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É
* –ê –∑–Ω–∞—á–∏—Ç, –º—ã –≥–æ–≤–æ—Ä–∏–º –æ CP —Å–∏—Å—Ç–µ–º–∞—Ö, —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø—Ä–µ—Å–ª–æ–≤—É—Ç–æ–π CAP —Ç–µ–æ—Ä–µ–º—ã

---

# –ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞

![h:600 center](./images/consensus-timeline.png)

---

# –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏: —Ç–µ–æ—Ä–∏—è

* [TLA+](https://lamport.azurewebsites.net/tla/tla.html) (L.Lamport)
* –Ø–∑—ã–∫ –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º –∏ —Å–∏—Å—Ç–µ–º, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∏ –Ω–µ —Ç–æ–ª—å–∫–æ

```
EXTENDS TLC

(* --algorithm hello_world
variable s \in {"Hello", "World!"};
begin
  A:
    print s;
end algorithm; *)
```

---

# –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏: –ø—Ä–∞–∫—Ç–∏–∫–∞

* [Jepsen](https://github.com/jepsen-io/jepsen) (K.Kingsbury a.k.a. aphyr)

```
INFO  jepsen.core - Analysis invalid! (Ôæâ‡≤•Áõä‡≤•ÔºâÔæâ ‚îª‚îÅ‚îª
```

<br/>

![h:250 center](./images/kkingsbury.png)

---

---

# –¢–µ–º–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞

* –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø—Ä—è–º—É—é –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ —Å–µ—Ç–∏
* –í—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
* –î–ª—è —Ä–∞–±–æ—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É–∑–ª–æ–≤ (—á—Ç–æ –ª–æ–≥–∏—á–Ω–æ)

---

<style scoped>
section h1 {
  position: absolute;
  top: 261px;
  left: 90px;
}
</style>

![bg](./images/hazelcast-bg-no-logo.jpg)

# –ò—Å—Ç–æ—Ä–∏—è: Paxos –∏ –µ–≥–æ –ø–æ–¥–≤–∏–¥—ã, Raft

---

# Vanilla Paxos

* Paxos (1998) - p2p (leaderless)
* –í –æ—Å–Ω–æ–≤–µ - Synod/Single-Decree Paxos
* –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–Ω—è—Ç—å —Å—Ç—Ä–æ–≥–æ –æ–¥–Ω–æ —Ä–µ—à–µ–Ω–∏–µ (–æ –∑–Ω–∞—á–µ–Ω–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞)
* –ß–∞—Å—Ç–æ –ø–æ–¥ Paxos –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞—é—Ç —Å–µ–º–µ–π—Å—Ç–≤–æ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

---

# –ü–æ–¥–≤–∏–¥—ã Paxos

* Multipaxos (2001)
* FastPaxos (2004~2005)
* Generalized Paxos (2004~2005)
* Mencius (2008)
* Multicoordinated Paxos (2006)
* Vertical Paxos (2009)
* Ring Paxos (2010) / Multi-Ring Paxos (2010)
* SPaxos (2012) / EPaxos (2013) / FPaxos (2016) / KPaxos (2017) / WPaxos (2017)
* __CASPaxos__ (2018)
* SDPaxos (2018)

---

# Raft

* Raft (2013) - single leader, replicated log
* –í—Ä–µ–º—è –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –ø–µ—Ä–∏–æ–¥—ã (term), –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ –≤—ã–±–æ—Ä–∞ –ª–∏–¥–µ—Ä–∞
* –£–ø–æ—Ä —Å–¥–µ–ª–∞–Ω –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞
* https://raft.github.io

---

<style scoped>
section h1 {
  position: absolute;
  top: 261px;
  left: 90px;
}
</style>

![bg](./images/hazelcast-bg-no-logo.jpg)

# CASPaxos, –∫–∞–∫ –æ–¥–∏–Ω<br/>–∏–∑ –Ω–µ–¥–∞–≤–Ω–∏—Ö Paxos-–æ–±—Ä–∞–∑–Ω—ã—Ö

---

# CASPaxos

* CASPaxos (D.Rystsov, 2018) - p2p, replicated state
* CAS - compare-and-set/compare-and-swap
* –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç Paxos (Synod), –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –∫–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

---

# –û—Å–Ω–æ–≤—ã CASPaxos

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–¥–∏–Ω —Ä–µ–≥–∏—Å—Ç—Ä (–æ–±—ä–µ–∫—Ç)
* –í–≤–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–æ–ª–µ–π –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:
  - Clients: –∫–ª–∏–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã, –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ Proposer
  - Proposers: –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ (proposal ID) –∏ –æ–±—â–∞—é—Ç—Å—è —Å Acceptors
  - Acceptors: –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è Proposers, —Ö—Ä–∞–Ω—è—Ç –ø—Ä–∏–Ω—è—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
* –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –¥–æ `F` –æ—Ç–∫–∞–∑–æ–≤, –Ω—É–∂–Ω—ã `2F + 1` Acceptors

---

# –§–∞–∑–∞ 1

![w:1100 center](./images/caspaxos-phase-1.png)

---

# –§–∞–∑–∞ 2

![w:1100 center](./images/caspaxos-phase-2.png)

---

# –°–≤—è–∑—å —Å Synod

CASPaxos —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ–Ω Synod, –µ—Å–ª–∏ –≤–∑—è—Ç—å —Ñ—É–Ω–∫—Ü–∏—é:
```
x -> if x = ‚àÖ then val0 else x
```

---

# CAS —Ä–µ–≥–∏—Å—Ç—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ CASPaxos

–ß—Ç–µ–Ω–∏–µ:
```
x -> x
```

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–µ–º `val0`:
```
x -> if x = ‚àÖ then (0, val0) else x
```

–ó–∞–ø–∏—Å—å –∑–Ω–∞—á–µ–Ω–∏—è `val1` –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –≤–µ—Ä—Å–∏–∏ `3`:
```
x -> if x = (3, *) then (4, val1) else x
```

---

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ CASPaxos

* –•—Ä–∞–Ω–∏–ª–∏—â–µ - —ç—Ç–æ –Ω–∞–±–æ—Ä –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ CASPaxos, –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–ª—é—á
* –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –ø–æ–¥—Ö–æ–¥–∞ –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å —Ç–µ–º –∂–µ Raft –≤—ã—Ö–æ–¥—è—Ç –∑–∞ —Ä–∞–º–∫–∏ –¥–æ–∫–ª–∞–¥–∞

---

# Pet-–ø—Ä–æ–µ–∫—Ç: CASPaxos –Ω–∞ Node.js

https://github.com/gryadka/js (Node.js - proposers, Redis - acceptors)
||
\\/
https://github.com/puzpuzpuz/ogorod (Node.js - proposers & acceptors)

---

# –ß–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–æ production-ready?

* –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è Paxos, –Ω–∞–ø—Ä–∏–º–µ—Ä, CASPaxos 1RTT
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ delete. –ù—É–∂–µ–Ω —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∞–ª—è GC (—Å–º. —Å—Ç–∞—Ç—å—é)
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, RocksDB
* –ü–µ—Ä–µ–π—Ç–∏ —Å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω—É–∂–¥ –ø–æ HTTP –∫ plain TCP
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
* –ò –º–Ω–æ–≥–æ —á–µ–≥–æ –µ—â–µ

---

<br/><br/>

# –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

<style scoped>
section {
  background: #fff url(images/hazelcast-plus-node.jpg) no-repeat center 80px;
  background-size: 400px;
}
</style>

* –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –±–æ—è—Ç—å—Å—è - –Ω–∞ server-side –Ω–µ —Ö–æ–¥–∏—Ç—å
* –í—Å–µ, –∫–æ–º—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏<br/>(–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã) - welcome
* https://github.com/hazelcast/hazelcast-nodejs-client
* P.S. Contributions are welcome as well

---

# –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ!

![w:400 center](./images/slides-qr-code.png)

---

# –ü–æ–ª–µ–∑–Ω—ã–µ –∫–Ω–∏–≥–∏ –∏ —Å—Å—ã–ª–∫–∏

* Designing Data-Intensive Applications, Martin Kleppmann, 2017
* CASPaxos: Replicated State Machines without logs, Denis Rystsov, 2018 - https://arxiv.org/abs/1802.07000
* Paxos Made Simple, Leslie Lamport, 2001 - https://lamport.azurewebsites.net/pubs/paxos-simple.pdf
* https://raft.github.io/raft.pdf
* https://jepsen.io
* https://martin.kleppmann.com/2015/05/11/please-stop-calling-databases-cp-or-ap.html
* https://vadosware.io/post/paxosmon-gotta-concensus-them-all/
